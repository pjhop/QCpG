<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started • QCpG</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
<meta property="og:description" content="A description of the advanced options available in the QC app.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">QCpG</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AdvancedOptions.html">Advanced Options</a>
    </li>
    <li>
      <a href="../articles/AvailableMetrics.html">Available metrics</a>
    </li>
    <li>
      <a href="../articles/EWASworkflow.html">Example EWAS workflow</a>
    </li>
    <li>
      <a href="../articles/GetExampleData.html">Get example data</a>
    </li>
    <li>
      <a href="../articles/GettingStarted.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/UsingTheApp.html">Using the QC app</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="GettingStarted_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started</h1>
            
      

      <div class="hidden name"><code>GettingStarted.Rmd</code></div>

    </div>

    
    
<p>Here, we show the basic usage of the package. The main workflow of the package can be summarized as follows:</p>
<p><img src="../images/workflow.png"></p>
<p>This package consists two main functions (corresponding to the first two steps of the workflow): <code><a href="../reference/getQCmetrics.html">getQCmetrics()</a></code> and <code><a href="../reference/QCapp.html">QCapp()</a></code>:</p>
<ul>
<li><p><code><a href="../reference/getQCmetrics.html">getQCmetrics()</a></code> : Create a <code>QCmetrics</code> object that contains summarized QC metrics, sample and probe outliers, relatedness info and several predicted traits/phenotypes (termed poly-methylation scores (PMS) here). The only input needed is a samplesheet containing the paths of the IDAT-files. Many more optional parameters can be specified (see <code><a href="../articles/AdvancedOptions.html">vignette("AdvancedOptions")</a></code>), for example: a genotype matrix can be supplied to assess DNAm-genotype concordance. This function will return an object of the <code>QCmetrics</code> class, which can be explored interactively using the <code><a href="../reference/QCapp.html">QCapp()</a></code> method.</p></li>
<li><p><code><a href="../reference/QCapp.html">QCapp()</a></code> : Visualize a <code>QCmetrics</code> object (obtained with the <code><a href="../reference/getQCmetrics.html">getQCmetrics()</a></code> function). This function launches a app in which the user can interactively explore the quality control metrics, set thresholds and define sample/probe outliers to be removed in subsequent analyses. In addition, relatedness among samples can be explored and several phenotypes/traits are included (age, sex, cell type fractions, smoking status, alcohol, and BMI). For comparison, other <code>QCmetrics</code> objects can be visualized in the background. When appropriate thresholds have been chosen, an updated QCmetrics object can be saved that contains the updated thresholds and outliers.</p></li>
</ul>
<p>We intend to share the Project MinE <code>QCmetrics</code> objects (±10,000 samples), that can be used as a reference. Below we put the above in practice using example data.</p>
<div class="section level2">
<h2 id="load-and-process-example-data">Load and process example data<a class="anchor" aria-label="anchor" href="#load-and-process-example-data"></a>
</h2>
<p>First, we’ll process the example data in the <a href="https://bioconductor.org/packages/release/data/experiment/html/minfiData.html" class="external-link">minfiData</a> package. Note that this is a very small dataset for example purposes, in the <code><a href="../articles/EWASworkflow.html">vignette("EWASworkflow")</a></code> vignette we showcase usage with a larger dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">minfiData</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">QCpG</span><span class="op">)</span></span>
<span><span class="va">tempdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Note that sex information should be coded as ‘M’/‘F’ (NA if missing):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Processing the data</span></span>
<span><span class="va">baseDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package<span class="op">=</span><span class="st">"minfiData"</span><span class="op">)</span></span>
<span><span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minfi/man/read.metharray.sheet.html" class="external-link">read.metharray.sheet</a></span><span class="op">(</span><span class="va">baseDir</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/hpc/hers_en/phop/software/R-4.4.0/lib64/R/library/minfiData/extdata/SampleSheet.csv"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The `getQCmetrics()` functions expects sex information to be coded as "M" and "F" (NA if missing) in a column named 'Sex" </span></span>
<span><span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="va">samplesheet</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sample_Name <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">samplesheet</span><span class="op">$</span><span class="va">Slide</span>,</span>
<span>                                  <span class="va">samplesheet</span><span class="op">$</span><span class="va">Array</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>                    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Sex <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-qcmetrics-object">Create QCmetrics object<a class="anchor" aria-label="anchor" href="#create-qcmetrics-object"></a>
</h2>
<p>The first step is to create a QCmetrics object using the <code><a href="../reference/getQCmetrics.html">getQCmetrics()</a></code> function. The main argument of this function is a samplesheet which should contain the following columns:</p>
<ul>
<li>
<code>Sample_Name</code> : Unique sample identifier. Should be: Array_Position.</li>
<li>
<code>Basename</code> : Paths to IDAT files</li>
<li>
<code>Sex</code> : Sex of the samples, coded as ‘M’/‘F’, or NA if missing.</li>
</ul>
<p>Create the QCmetrics object: (note that the function has many more optional arguments, e.g. to include a genotype matrix to assess DNAm-genotype concordance, see <code><a href="../articles/AdvancedOptions.html">vignette("AdvancedOptions")</a></code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run getQCmetrics function with default parameters </span></span>
<span><span class="va">qcmetrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getQCmetrics.html">getQCmetrics</a></span><span class="op">(</span><span class="va">samplesheet</span><span class="op">)</span></span>
<span><span class="va">qcmetrics</span></span></code></pre></div>
<pre><code><span><span class="co">## class: QCmetrics</span></span>
<span><span class="co">## array: 450k</span></span>
<span><span class="co">## dim: 485512 6</span></span></code></pre>
<p>This results in an object of class <code>QCmetrics</code> and several common functions can be used to inspect it:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span> <span class="co"># Dimensions</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 485512      6</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span> <span class="co"># Number of probes</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 485512</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span> <span class="co"># Number of samples</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 6</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span> <span class="co"># Sample names</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "5723646052_R02C02" "5723646052_R04C01" "5723646052_R05C02"</span></span>
<span><span class="co">## [4] "5723646053_R04C02" "5723646053_R05C02" "5723646053_R06C02"</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span><span class="op">)</span> <span class="co"># Probe names</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "cg00050873" "cg00212031" "cg00213748" "cg00214611" "cg00455876"</span></span>
<span><span class="co">## [6] "cg01707559"</span></span></code></pre>
<p>Show metadata:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html" class="external-link">metadata</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Experiment Name: -</span></span>
<span><span class="co">## Experimenter: -</span></span>
<span><span class="co">## Array: 450k</span></span>
<span><span class="co">## Package Version: 1.0.0</span></span>
<span><span class="co">## Created at: 2024-07-18</span></span></code></pre>
<p>Note that the ‘Experiment_Name’ and ‘Experimenter’ fields are empty, these can be set when creating the QCmetrics object:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run getQCmetrics function with default parameters </span></span>
<span><span class="va">qcmetrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getQCmetrics.html">getQCmetrics</a></span><span class="op">(</span><span class="va">samplesheet</span>, </span>
<span>                           name <span class="op">=</span> <span class="st">"minfiData"</span>,</span>
<span>                           experimenter <span class="op">=</span> <span class="st">"Paul Hop"</span><span class="op">)</span></span>
<span>                           </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Annotated-class.html" class="external-link">metadata</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Experiment Name: minfiData</span></span>
<span><span class="co">## Experimenter: Paul Hop</span></span>
<span><span class="co">## Array: 450k</span></span>
<span><span class="co">## Package Version: 1.0.0</span></span>
<span><span class="co">## Created at: 2024-07-18</span></span></code></pre>
<p>Note that principal components (PCs) are not calculated by default, since this may significantly increase the RAM usage. By setting <code>calculate_PCs = TRUE</code> PCs will be calculated, RAM size can be reduced by limiting PCA to the most variable probes:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run getQCmetrics function with default parameters </span></span>
<span><span class="va">qcmetrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getQCmetrics.html">getQCmetrics</a></span><span class="op">(</span><span class="va">samplesheet</span>, </span>
<span>                           name <span class="op">=</span> <span class="st">"minfiData"</span>,</span>
<span>                           calculate_PCs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                           n_probes_PCA <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>                           experimenter <span class="op">=</span> <span class="st">"Paul Hop"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualize">Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h2>
<p>Now that we’ve created a QCmetrics object, the next step is to visualize it by launching the QCapp:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Launch app (only works in interactive session)</span></span>
<span><span class="fu"><a href="../reference/QCapp.html">QCapp</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<p>This will launch the QCapp in your default browser (Chrome is recommended), which will look something like this (note this is a screenshot from the example data shown in <code>vignette("EWASworkflow"):</code></p>
<p><img src="images/workflow_QCapp_controlPCA.png"></p>
<p>Within the app users can visualize both samples and probes across several QC metrics, inspect relatedness among the samples and inspect predicted phenotypes (PMS). This package contains a set of default thresholds based on a combination of defaults used in underlying packages (<em>MethylAid</em>, <em>wateRmelon, minfi</em>) and defaults based on our experience with Project MinE data. More details on the QC metrics used and usage of the QC app are provided in section 5. When appropriate thresholds have been chosen, an updated QCmetrics object can be saved that contains the updated thresholds and outliers.</p>
<p>Another <code>QCmetrics</code> object can be supplied to the <code>background</code> parameter, which will then be plotted as background in the relevant plots.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Launch app (only works in interactive session)</span></span>
<span><span class="fu"><a href="../reference/QCapp.html">QCapp</a></span><span class="op">(</span><span class="va">qcmetrics</span>, background <span class="op">=</span> <span class="va">qcmetrics2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extract-sampleprobe-outliers-related-samples-and-pmss">Extract sample/probe outliers, related samples and PMSs<a class="anchor" aria-label="anchor" href="#extract-sampleprobe-outliers-related-samples-and-pmss"></a>
</h2>
<p>The main methods to extract samples/probes are:</p>
<ul>
<li><p><code><a href="../reference/getSampleOutliers.html">getSampleOutliers()</a></code> : Extracts samples that fail QC based on thresholds saved within the QCobjects object*</p></li>
<li><p><code><a href="../reference/getProbeOutliers.html">getProbeOutliers()</a></code> : Extracts probes that fail QC based on thresholds saved within the QCobjects object*</p></li>
<li><p><code><a href="../reference/getRelatedPairs.html">getRelatedPairs()</a></code> : Extracts pairs of samples that appear to be related based on thresholds saved within the QCobjects object*</p></li>
<li><p><code><a href="../reference/getPMS.html">getPMS()</a></code> : Returns predicted phenotypes for all samples. Phenotypes currently included are: age (three predictors), sex, smoking score, BMI, alcohol, and cell-type fractions.</p></li>
</ul>
<p>*these thresholds can be modified within the QC app</p>
<p>Extract sample outliers:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getSampleOutliers.html">getSampleOutliers</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 11</span></span></span>
<span><span class="co">##   Sample_Name MU_outlier RG_ratio_outlier GR_ratio_outlier OP_outlier HC_outlier</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 5723646052… FALSE      FALSE            FALSE            FALSE      FALSE     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 5723646053… FALSE      FALSE            FALSE            FALSE      FALSE     </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5 more variables: bscon_outlier &lt;lgl&gt;, detectionP_outlier &lt;lgl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   beadNr_outlier &lt;lgl&gt;, sex_outlier &lt;lgl&gt;, Total &lt;lgl&gt;</span></span></span></code></pre>
<p>Show an overview of outliers:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getOutlierOverview.html">getOutlierOverview</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 3</span></span></span>
<span><span class="co">##    Metric     Nr_Outliers Nr_Unique_Outliers</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> GR_ratio             0                  0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> HC                   0                  0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> MU                   0                  0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> OP                   0                  0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> RG_ratio             0                  0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> beadNr               0                  0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> bscon                0                  0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> detectionP           2                  2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> sex                  0                  0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Total                2                 <span style="color: #BB0000;">NA</span></span></span></code></pre>
<p>Extract probe outliers:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getProbeOutliers.html">getProbeOutliers</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 27,500 × 4</span></span></span>
<span><span class="co">##    Probe      BeadNr_Percentage detP_Percentage Total</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> cg17837162 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> cg18032798 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> cg18077436 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> cg05940236 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> cg06855731 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> cg14778208 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> cg14972466 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> cg15273954 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> cg15662272 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> cg00598664 FALSE             TRUE            TRUE </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 27,490 more rows</span></span></span></code></pre>
<p>Extract related pairs of individuals:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getRelatedPairs.html">getRelatedPairs</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       Sample_Name.x     Sample_Name.y IBS_mean IBS_var</span></span>
<span><span class="co">## 1 5723646052_R05C02 5723646052_R02C02      2.0     0.0</span></span>
<span><span class="co">## 2 5723646053_R06C02 5723646052_R04C01      1.9     0.1</span></span>
<span><span class="co">## 3 5723646053_R05C02 5723646053_R04C02      1.9     0.1</span></span></code></pre>
<p>Extract predicted phenotypes:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getPMS.html">getPMS</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 15</span></span></span>
<span><span class="co">##   Sample_Name       Predicted_Age Predicted_Age_Zhang_en Predicted_Age_Zhang_b…¹</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 5723646052_R02C02          69.8                   79.1                    77.2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 5723646052_R04C01          56.6                   76.7                    71.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 5723646052_R05C02          45.5                   69.2                    87.4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 5723646053_R04C02          54.6                   90.2                    98.7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 5723646053_R05C02          69.3                   89.6                    84.0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 5723646053_R06C02          56.4                   88.3                    98.3</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ abbreviated name: ¹​Predicted_Age_Zhang_blup</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 11 more variables: Smoking_PMS &lt;dbl&gt;, Alcohol_PMS &lt;dbl&gt;, BMI_PMS &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   predictedSex &lt;chr&gt;, B &lt;dbl&gt;, NK &lt;dbl&gt;, CD4T &lt;dbl&gt;, CD8T &lt;dbl&gt;, Mono &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   Neutro &lt;dbl&gt;, Eosino &lt;dbl&gt;</span></span></span></code></pre>
</div>
<div class="section level2">
<h2 id="save-publication-quality-plots">Save publication-quality plots<a class="anchor" aria-label="anchor" href="#save-publication-quality-plots"></a>
</h2>
<p>Although we recommend interactively exploring the <code>QCmetrics</code> in the <code><a href="../reference/QCapp.html">QCapp()</a></code>, you may want to save high-quality figures for publication purposes for example. Although it is possible to save plots within the <code><a href="../reference/QCapp.html">QCapp()</a></code> by clicking ‘Download plot as png’ in the toolbar shown in the right upper corner of plots, this doesn’t provide much control for example the size and quality of the figure and is tedious to do for each figure individually. Therefore, we included a <code><a href="../reference/savePlots.html">savePlots()</a></code> method, that saves all plots to a specified directory and allows control over quality, size, filetype etc.</p>
<p>Example:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/savePlots.html">savePlots</a></span><span class="op">(</span><span class="va">qcmetrics</span>,</span>
<span>          outdir <span class="op">=</span> <span class="st">"~/test_dir"</span>,</span>
<span>          name <span class="op">=</span> <span class="st">"minfidata"</span><span class="op">)</span></span></code></pre></div>
<p>Fine-tune figure properties and color by Sex:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/savePlots.html">savePlots</a></span><span class="op">(</span><span class="va">qcmetrics</span>,</span>
<span>          outdir <span class="op">=</span> <span class="st">"~/test_dir"</span>,</span>
<span>          name <span class="op">=</span> <span class="st">"minfidata"</span>, </span>
<span>          colorby <span class="op">=</span> <span class="st">"Sex"</span>,</span>
<span>          filetype <span class="op">=</span> <span class="st">"pdf"</span>,</span>
<span>          point_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>          width <span class="op">=</span> <span class="fl">6</span>,</span>
<span>          height <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="update-qcmetrics-file">Update QCmetrics file<a class="anchor" aria-label="anchor" href="#update-qcmetrics-file"></a>
</h2>
<p>After samples and probes have been excluded and data is normalized, you may want to update the QCmetrics file with PCs/PMSs based on the cleaned/normalized data.</p>
<p>The <code><a href="../reference/updateQCmetrics.html">updateQCmetrics()</a></code> method does just that, below an example where samples/probes are excluded based on the <code>QCmetrics</code> file, normalized using <code><a href="https://rdrr.io/pkg/minfi/man/preprocessFunnorm.html" class="external-link">minfi::preprocessFunnorm()</a></code> (see <code><a href="../articles/EWASworkflow.html">vignette("EWASworkflow")</a></code> )</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Example cleaned/normalized qcmetrics file</span></span>
<span><span class="va">qcmetrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getQCmetrics.html">getQCmetrics</a></span><span class="op">(</span><span class="va">samplesheet</span><span class="op">)</span></span>
<span><span class="va">rgset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minfi/man/read.metharray.html" class="external-link">read.metharray</a></span><span class="op">(</span><span class="va">samplesheet</span><span class="op">$</span><span class="va">Basename</span>, extended<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Normalize using functional normalization</span></span>
<span><span class="va">rgset_normalized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minfi/man/preprocessFunnorm.html" class="external-link">preprocessFunnorm</a></span><span class="op">(</span><span class="va">rgset</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rgset</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/getSampleOutliers.html">getSampleOutliers</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span><span class="op">$</span><span class="va">Sample_Name</span><span class="op">]</span>, nPCs <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get beta-values </span></span>
<span><span class="va">beta_normalized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minfi/man/MethylSet-class.html" class="external-link">getBeta</a></span><span class="op">(</span><span class="va">rgset_normalized</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove failed probes </span></span>
<span><span class="va">beta_normalized</span> <span class="op">&lt;-</span> <span class="va">beta_normalized</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta_normalized</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="../reference/getProbeOutliers.html">getProbeOutliers</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span><span class="op">$</span><span class="va">Probe</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Update qcmetrics based on normalized betas</span></span>
<span><span class="va">qcmetrics_updated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/updateQCmetrics.html">updateQCmetrics</a></span><span class="op">(</span>qcmetrics <span class="op">=</span> <span class="va">qcmetrics</span>,</span>
<span>                                     samplesheet <span class="op">=</span> <span class="va">samplesheet</span>,</span>
<span>                                     beta <span class="op">=</span> <span class="va">beta_normalized</span>,</span>
<span>                                     calculate_PCs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">qcmetrics_updated</span></span></code></pre></div>
<pre><code><span><span class="co">## class: QCmetrics</span></span>
<span><span class="co">## array: 450k</span></span>
<span><span class="co">## dim: 458012 4</span></span></code></pre>
<p>Note that the <code><a href="../reference/updateQCmetrics.html">updateQCmetrics()</a></code> method can also read in the betas in chunks from a txt-file to reduce RAM usage:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For this example, save the normalized betas to a txt-file</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Probe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta_normalized</span><span class="op">)</span>, <span class="va">beta_normalized</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/beta_normalized.txt"</span>, <span class="va">tempdir</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qcmetrics_updated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/updateQCmetrics.html">updateQCmetrics</a></span><span class="op">(</span>qcmetrics <span class="op">=</span> <span class="va">qcmetrics</span>,</span>
<span>                                     samplesheet <span class="op">=</span> <span class="va">samplesheet</span>,</span>
<span>                                     beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/beta_normalized.txt"</span>, <span class="va">tempdir</span><span class="op">)</span>,</span>
<span>                                     read_chunks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                     chunk_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                     calculate_PCs <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">qcmetrics_updated</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 458012      4</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul Hop.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
