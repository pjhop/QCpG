<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example EWAS workflow • QCpG</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example EWAS workflow">
<meta property="og:description" content="Example EWAS workflow
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">QCpG</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AdvancedOptions.html">Advanced Options</a>
    </li>
    <li>
      <a href="../articles/AvailableMetrics.html">Available metrics</a>
    </li>
    <li>
      <a href="../articles/EWASworkflow.html">Example EWAS workflow</a>
    </li>
    <li>
      <a href="../articles/GetExampleData.html">Get example data</a>
    </li>
    <li>
      <a href="../articles/GettingStarted.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/UsingTheApp.html">Using the QC app</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><script src="EWASworkflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example EWAS workflow</h1>
            
      

      <div class="hidden name"><code>EWASworkflow.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This tutorial illustrates how this package can be used in conjunction with several other R packages to form a complete EWAS workflow. Note that for several steps (i.e. normalization and EWAS confounder adjustment) many methods exist, although it’s outside the scope of this tutorial to provide a comprehensive overview of all these methods, we mention some alternatives at the end of this tutorial.</p>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>For this tutorial we’ll use a subset of the rheumatoid arthritis dataset described in <code><a href="../articles/GetExampleData.html">vignette("GetExampleData")</a></code> <span class="citation">(Liu et al. 2013)</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">QCpG</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">wateRmelon</span><span class="op">)</span></span>
<span><span class="va">outdir</span> <span class="op">&lt;-</span> <span class="st">"../GSE42861"</span></span></code></pre></div>
<p>All results and intermediate files will be save in the ‘workflow’ folder within the output directory (<code>outdir</code>) specified above.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/logs"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-and-inspect-qcmetrics">Create and inspect QCmetrics<a class="anchor" aria-label="anchor" href="#create-and-inspect-qcmetrics"></a>
</h2>
<div class="section level3">
<h3 id="generate-qcmetrics">Generate QCmetrics<a class="anchor" aria-label="anchor" href="#generate-qcmetrics"></a>
</h3>
<p>We start by generating a QCmetrics file, we’ll briefly describe the parameters we’ve specified:</p>
<ul>
<li><p><code>logfile</code>: file where log info will be written</p></li>
<li><p><code>chunk_size</code>: maximum number of samples that will loaded at a time, a larger <code>chunk_size</code> will speed up the analysis, but will use more RAM.</p></li>
<li><p><code>experimenter</code>/<code>name</code>: This will be stored in the metadata of the <code>QCmetrics()</code> object.</p></li>
<li><p><code>snplinker</code>: Which probes to use to estimate genetic relationships (i.e. which probes reflect underling SNPs). Here we use the <code>snplinker_mine</code> dataset which is included in the R package, this dataset includes probes that were shown to accurately measure underlying SNPs in the Project MinE data.</p></li>
<li><p><code>heatmap_variables</code>/<code>heatmap_variables_fct</code>: For which variables should the association with principal components be calculated (which are displayed in a heatmap in the <code><a href="../reference/QCapp.html">QCapp()</a></code> (<code>heatmap_variables_fct</code> indicates which variables should be treated as factors.</p></li>
<li><p><code>calculate_PCs</code> / <code>n_probes_PCA</code>: Specified that PCA should be performed using the 20,000 most variable probes.</p></li>
<li><p><code>path_failed_measurements</code>: Indicates that a sparse matrix should be saved that indicates for each measurement whether it is of low quality. In <a href="#mask">Mask low-quality measurements</a> we show how to use this matrix to mask low-quality measurements.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/samplesheet_GSE42861.rds"</span>, <span class="va">outdir</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate QC metrics object</span></span>
<span><span class="va">qcmetrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getQCmetrics.html">getQCmetrics</a></span><span class="op">(</span> </span>
<span>  samplesheet <span class="op">=</span> <span class="va">samplesheet</span>,</span>
<span>  logfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/logs/qcmetrics.log"</span><span class="op">)</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  experimenter <span class="op">=</span> <span class="st">"Paul Hop"</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"GSE42861"</span>,</span>
<span>  snplinker <span class="op">=</span> <span class="fu">QCpG</span><span class="fu">::</span><span class="va"><a href="../reference/snplinker_mine.html">snplinker_mine</a></span>,</span>
<span>  heatmap_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"disease_state"</span>, <span class="st">"Age"</span>, <span class="st">"Smoking_Status"</span>, <span class="st">"Slide"</span><span class="op">)</span>,</span>
<span>  heatmap_variables_fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"disease_state"</span>, <span class="st">"Smoking_Status"</span>, <span class="st">"Slide"</span><span class="op">)</span>,</span>
<span>  calculate_PCs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_probes_PCA <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>  path_failed_measurements <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/failed_measurements.rds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Creating a QCmetrics object</span></span>
<span><span class="co">#&gt; Analysis started at: 2024-07-17 16:51:38</span></span>
<span><span class="co">#&gt; Array: 450k</span></span>
<span><span class="co">#&gt; -----------------------------</span></span>
<span><span class="co">#&gt; Loading required package: IlluminaHumanMethylation450kmanifest</span></span>
<span><span class="co">#&gt; Extracting QCmetrics in chunks of 40 samples..</span></span>
<span><span class="co">#&gt; Using 144/144 probes for alcohol prediction</span></span>
<span><span class="co">#&gt; Using 187/187 probes for smoking prediction</span></span>
<span><span class="co">#&gt; Using 435/435 probes for BMI prediction</span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt; Merging the chunks..</span></span>
<span><span class="co">#&gt; Performing IBS..</span></span>
<span><span class="co">#&gt; 357 out of 426 probes could be accurately called</span></span>
<span><span class="co">#&gt; Calculating relatedness using the DNAm-inferred SNPs</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Saving a matrix specifying failed measurements to ../GSE42861/workflow/failed_measurements.rds</span></span>
<span><span class="co">#&gt; Performing array-wide PCA..</span></span>
<span><span class="co">#&gt; Performing control probe PCA..</span></span>
<span><span class="co">#&gt; Performing association tests between array-wide PCs and technical/biological variables..</span></span>
<span><span class="co">#&gt; Performing association tests between control probe PCs and technical/biological variables..</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Merging the metrics..</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of outliers using default thresholds:</span></span>
<span><span class="co">#&gt; MU: 0 outliers (0%)</span></span>
<span><span class="co">#&gt; RG_ratio: 0 outliers (0%)</span></span>
<span><span class="co">#&gt; GR_ratio: 0 outliers (0%)</span></span>
<span><span class="co">#&gt; OP: 0 outliers (0%)</span></span>
<span><span class="co">#&gt; HC: 0 outliers (0%)</span></span>
<span><span class="co">#&gt; bscon: 0 outliers (0%)</span></span>
<span><span class="co">#&gt; detectionP: 3 outliers (1.96%)</span></span>
<span><span class="co">#&gt; beadNr: 0 outliers (0%)</span></span>
<span><span class="co">#&gt; sex: 0 outliers (0%)</span></span>
<span><span class="co">#&gt; Total: 3 outliers (1.96%)</span></span>
<span><span class="co">#&gt; Done!</span></span>
<span><span class="co">#&gt; Analysis finished at: 2024-07-17 17:00:27</span></span>
<span></span>
<span><span class="co"># Save </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">qcmetrics</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/qcmetrics.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspect-qcmetrics">Inspect QCmetrics<a class="anchor" aria-label="anchor" href="#inspect-qcmetrics"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/QCapp.html">QCapp</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
<p>Some examples:</p>
<p><img src="images/workflow_QCapp_controlPCA-01.png"></p>
<p><img src="images/workflow_QCapp_sex.png"></p>
<p><img src="images/workflow_QCapp_age.png"></p>
<p><img src="images/workflow_QCapp_relatedness-01.png"></p>
</div>
<div class="section level3">
<h3 id="save-publication-quality-figures">Save publication-quality figures<a class="anchor" aria-label="anchor" href="#save-publication-quality-figures"></a>
</h3>
<p>Although we recommend interactively exploring the <code>QCmetrics</code> in the <code><a href="../reference/QCapp.html">QCapp()</a></code> you may want to save the visualizations shown within the <code><a href="../reference/QCapp.html">QCapp()</a></code> to your computer for publication purposes for example. Therefore, we included a `savePlots()` method, that saves all plots to a specified directory and allows control over quality, size, filetype etc.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/savePlots.html">savePlots</a></span><span class="op">(</span><span class="va">qcmetrics</span>,</span>
<span>          outdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/workflow/figures"</span>, <span class="va">outdir</span><span class="op">)</span>,</span>
<span>          name <span class="op">=</span> <span class="st">"ewas_GSE42861"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Saving plots in ../GSE42861/workflow/figures/</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="cleannormalize">Clean &amp; Normalize<a class="anchor" aria-label="anchor" href="#cleannormalize"></a>
</h2>
<p>After inspecting the <code>QCmetrics</code>, we’ll continue with removing sample and probes that failed QC and additionally we’ll exclude related samples.</p>
<div class="section level3">
<h3 id="specify-samples-and-probes-to-exclude">Specify samples and probes to exclude<a class="anchor" aria-label="anchor" href="#specify-samples-and-probes-to-exclude"></a>
</h3>
<p>We can use the getters (<code><a href="../reference/getSampleOutliers.html">getSampleOutliers()</a></code>, <code><a href="../reference/getProbeOutliers.html">getProbeOutliers()</a></code> and <code><a href="../reference/getRelatedPairs.html">getRelatedPairs()</a></code>) to extract samples and probes to exclude:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSampleOutliers.html">getSampleOutliers</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span>
<span><span class="va">probe_outliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getProbeOutliers.html">getProbeOutliers</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span>
<span><span class="va">related_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getRelatedPairs.html">getRelatedPairs</a></span><span class="op">(</span><span class="va">qcmetrics</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="normalize">Normalize<a class="anchor" aria-label="anchor" href="#normalize"></a>
</h3>
<p>For normalization we’ll use the <code><a href="https://rdrr.io/pkg/wateRmelon/man/dasen.html" class="external-link">dasen()</a></code> function from the <a href="https://www.bioconductor.org/packages/release/bioc/html/wateRmelon.html" class="external-link">wateRmelon</a> R package <span class="citation">(Pidsley et al. 2013)</span>. We recommend the <a href="https://www.bioconductor.org/packages/release/bioc/html/wateRmelon.html" class="external-link">bigmelon</a> package for a more memory-efficient implementation of these functions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create Mset</span></span>
<span><span class="va">mset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/wateRmelon/man/readEPIC.html" class="external-link">readEPIC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/IDATs"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove sample outliers from Mset</span></span>
<span><span class="va">mset</span> <span class="op">&lt;-</span> <span class="va">mset</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mset</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sample_outliers</span><span class="op">$</span><span class="va">Sample_Name</span>, <span class="va">related_samples</span><span class="op">$</span><span class="va">Sample_Name.x</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># save</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">mset</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/mset_cleaned.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Normalize using dasen</span></span>
<span><span class="va">mset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/wateRmelon/man/dasen.html" class="external-link">dasen</a></span><span class="op">(</span><span class="va">mset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get betas </span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/methylumi/man/generics.html" class="external-link">betas</a></span><span class="op">(</span><span class="va">mset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove failed probes and remove SNP-probes</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">probe_outliers</span><span class="op">$</span><span class="va">Probe</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"rs"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save rds-file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">beta</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/beta_cleaned_normalized.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># also save as txt-file</span></span>
<span><span class="va">probes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>Probe <span class="op">=</span> <span class="va">probes</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">beta</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/beta_cleaned_normalized.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="update-qcmetrics">Update QCmetrics<a class="anchor" aria-label="anchor" href="#update-qcmetrics"></a>
</h3>
<p>After normalization, the <code>QCmetrics</code> object can be updated using the <code><a href="../reference/updateQCmetrics.html">updateQCmetrics()</a></code> where the principal components and polymethylation scores are recalculated based on the normalized betas:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qcmetrics_cleaned</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/updateQCmetrics.html">updateQCmetrics</a></span><span class="op">(</span></span>
<span>  qcmetrics <span class="op">=</span> <span class="va">qcmetrics</span>,</span>
<span>  samplesheet <span class="op">=</span> <span class="va">qcmetrics</span><span class="op">@</span><span class="va">samplesheet</span>,</span>
<span>  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/beta_cleaned_normalized.txt"</span><span class="op">)</span>,</span>
<span>  beta_format <span class="op">=</span> <span class="st">"txt"</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  calculate_PCs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_probes_PCA <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>  heatmap_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"disease_state"</span>, <span class="st">"Age"</span>, <span class="st">"Smoking_Status"</span>, <span class="st">"Slide"</span><span class="op">)</span>,</span>
<span>  heatmap_variables_fct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"disease_state"</span>, <span class="st">"Smoking_Status"</span>, <span class="st">"Slide"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 149 samples overlap between the QCmetrics object and the beta-matrix</span></span>
<span><span class="co">#&gt; 4 samples will be removed from the QC metrics object</span></span>
<span><span class="co">#&gt; Reading ../GSE42861/workflow/beta_cleaned_normalized.txt in chunks of 40 samples..</span></span>
<span><span class="co">#&gt; Using 143/144 probes for alcohol prediction</span></span>
<span><span class="co">#&gt; Using 186/187 probes for smoking prediction</span></span>
<span><span class="co">#&gt; Using 424/435 probes for BMI prediction</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">qcmetrics_cleaned</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/qcmetrics_cleaned.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="mask">Mask low-quality measurements<a class="anchor" aria-label="anchor" href="#mask"></a>
</h2>
<p>In <a href="#create-and-inspect-qcmetrics">Create and inspect QCmetrics</a> we have saved a matrix that indicates for each measurement whether it has failed QC. We can use this matrix in the <code><a href="../reference/mask_measurements.html">mask_measurements()</a></code> function to set these low quality measures to missing:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/failed_measurements.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/mask_measurements.html">mask_measurements</a></span><span class="op">(</span></span>
<span>  beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/beta_cleaned_normalized.txt"</span><span class="op">)</span>,</span>
<span>  mask_matrix <span class="op">=</span> <span class="va">mask</span>,</span>
<span>  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>,<span class="st">"/workflow/beta_cleaned_normalized_masked.txt"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="perform-an-ewas">Perform an EWAS<a class="anchor" aria-label="anchor" href="#perform-an-ewas"></a>
</h2>
<p>In this section we’ll perform an EWAS on smoking status (currents vs. never/past smokers). We use <a href="https://bioconductor.org/packages/release/bioc/html/limma.html" class="external-link">limma</a> <span class="citation">(Ritchie et al. 2015)</span> to perform the association tests (linear models).</p>
<p>We’ll control for both known confounders, as well as several DNAm-derived variables included in the <code>QCmetrics()</code> object:</p>
<ul>
<li><p>Array-wide PCs (<code><a href="../reference/getPCs.html">getPCs()</a></code>)</p></li>
<li><p>Control probe PCs (<code><a href="../reference/getControlPCs.html">getControlPCs()</a></code>)</p></li>
<li><p>DNAm-based predictors (poly-methylation scores) of Alcohol use and BMI. (<code><a href="../reference/getPMS.html">getPMS()</a></code>)</p></li>
</ul>
<p>After performing these linear models, we used <a href="https://bioconductor.org/packages/release/bioc/html/bacon.html" class="external-link">bacon</a> to control for residual bias/inflation in test-statistics <span class="citation">(Iterson, Zwet, and Heijmans 2017)</span>. In the <a href="#ewas">EWAS</a> section we discuss a few alternative methods.</p>
<div class="section level3">
<h3 id="prepare-data">Prepare data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h3>
<p>Prepare an annotation file and add PCs, control PCs and PMSs included in <code>QCmetrics()</code> to the samplesheet:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">IlluminaHumanMethylation450kanno.ilmn12.hg19</span><span class="op">)</span> <span class="co"># annotation file</span></span>
<span></span>
<span><span class="va">qcmetrics_cleaned</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/qcmetrics_cleaned.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Annotation file </span></span>
<span><span class="va">anno_450k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/minfi/man/getAnnotation.html" class="external-link">getAnnotation</a></span><span class="op">(</span><span class="va">IlluminaHumanMethylation450kanno.ilmn12.hg19</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">anno_450k_autosomal</span> <span class="op">&lt;-</span> <span class="va">anno_450k</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">chr</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"chrX"</span>, <span class="st">"chrY"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add PCs and polymethylation scores to samplesheet </span></span>
<span><span class="va">samplesheet</span><span class="op">=</span><span class="va">qcmetrics_cleaned</span><span class="op">@</span><span class="va">samplesheet</span></span>
<span><span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="va">samplesheet</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/getPMS.html">getPMS</a></span><span class="op">(</span><span class="va">qcmetrics_cleaned</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"Sample_Name"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/getPCs.html">getPCs</a></span><span class="op">(</span><span class="va">qcmetrics_cleaned</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"Sample_Name"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/getControlPCs.html">getControlPCs</a></span><span class="op">(</span><span class="va">qcmetrics_cleaned</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"Sample_Name"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## Format Smoking status as 1 (current smoker) and 0 (never or ex-smoker)</span></span>
<span><span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="va">samplesheet</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Smoking <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>  <span class="va">Smoking_Status</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"current"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1L</span>,</span>
<span>  <span class="va">Smoking_Status</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"never"</span>, <span class="st">"ex"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0L</span>,</span>
<span>  <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_integer_</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="limma-bacon">Limma + bacon<a class="anchor" aria-label="anchor" href="#limma-bacon"></a>
</h3>
<p>Here we perform the linear models (adjusted for potential confounders) followed by bacon. Note that we perform limma at the entire beta-matrix at once. Alternatively, the linear models could be performed at chunks of the beta-matrix at a time to reduce RAM usage.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioinf.wehi.edu.au/limma/" class="external-link">limma</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bacon</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Remove samples for which smoking outcome is unavailable:</span></span>
<span><span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="va">samplesheet</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Smoking</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Specify design matrix</span></span>
<span><span class="va">pheno</span> <span class="op">&lt;-</span> <span class="st">"Smoking"</span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"disease_state"</span>, <span class="st">"Age"</span>, <span class="st">"Sex"</span>, <span class="st">"Alcohol_PMS"</span>, <span class="st">"BMI_PMS"</span>, <span class="st">"NK"</span>, <span class="st">"CD4T"</span>, <span class="st">"CD8T"</span>, <span class="st">"Mono"</span>, <span class="st">"Neutro"</span>,</span>
<span>                <span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span>, <span class="st">"PC4"</span>, <span class="st">"PC5"</span>, <span class="st">"PC1_control"</span>, <span class="st">"PC2_control"</span>, <span class="st">"PC3_control"</span>, <span class="st">"PC4_control"</span>, <span class="st">"PC5_control"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"~%s + %s"</span>, <span class="va">pheno</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">covariates</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">formula</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">samplesheet</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load normalized and masked beta-matrix:</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>,<span class="st">"/workflow/beta_cleaned_normalized_masked.txt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">probes</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">$</span><span class="va">Probe</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">probes</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">anno_450k_autosomal</span><span class="op">$</span><span class="va">Name</span>,<span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Peform EWAS</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">limma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html" class="external-link">lmFit</a></span><span class="op">(</span><span class="va">beta</span>, <span class="va">design</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract p-values</span></span>
<span><span class="va">ordinary.t</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">coef</span> <span class="op">/</span> <span class="va">fit</span><span class="op">$</span><span class="va">stdev.unscaled</span> <span class="op">/</span> <span class="va">fit</span><span class="op">$</span><span class="va">sigma</span></span>
<span><span class="va">pval</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">pt</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">ordinary.t</span><span class="op">)</span>, <span class="va">fit</span><span class="op">$</span><span class="va">df.residual</span><span class="op">)</span></span>
<span><span class="va">pval</span> <span class="op">&lt;-</span> <span class="va">pval</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>Probe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pval</span><span class="op">)</span>,</span>
<span>                b <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">pval</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                t <span class="op">=</span> <span class="va">ordinary.t</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,</span>
<span>                se <span class="op">=</span> <span class="va">b</span> <span class="op">/</span> <span class="va">t</span>,</span>
<span>                p <span class="op">=</span> <span class="va">pval</span>, </span>
<span>                logp <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">pval</span><span class="op">)</span>,</span>
<span>                df <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Perform bacon</span></span>
<span><span class="va">bacon</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">stats</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">bc</span> <span class="op">&lt;-</span> <span class="fu">bacon</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bacon/man/bacon.html" class="external-link">bacon</a></span><span class="op">(</span>effectsizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">stats</span><span class="op">$</span><span class="va">b</span><span class="op">)</span>, standarderrors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">stats</span><span class="op">$</span><span class="va">se</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">stats</span><span class="op">$</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="fu">bacon</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bacon/man/es-methods.html" class="external-link">es</a></span><span class="op">(</span><span class="va">bc</span><span class="op">)</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="va">stats</span><span class="op">$</span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="fu">bacon</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bacon/man/se-methods.html" class="external-link">se</a></span><span class="op">(</span><span class="va">bc</span><span class="op">)</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span>  <span class="va">stats</span><span class="op">$</span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="fu">bacon</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/bacon/man/tstat-methods.html" class="external-link">tstat</a></span><span class="op">(</span><span class="va">bc</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">stats</span><span class="op">$</span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">pt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">stats</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>, df <span class="op">=</span> <span class="va">stats</span><span class="op">$</span><span class="va">df</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">stats</span></span>
<span><span class="op">}</span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bacon/man/bacon.html" class="external-link">bacon</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Significant sites</span></span>
<span><span class="va">threshold</span> <span class="op">&lt;-</span> <span class="fl">2.4</span> <span class="op">*</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">7</span> <span class="co"># see (Mansell et al. 2019)</span></span>
<span></span>
<span><span class="va">stats_sig</span> <span class="op">&lt;-</span> <span class="va">stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="va">threshold</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add annotation</span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">anno_450k</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"chr"</span>, <span class="st">"pos"</span>, <span class="st">"UCSC_RefGene_Name"</span>, <span class="st">"UCSC_RefGene_Group"</span><span class="op">)</span><span class="op">]</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Probe"</span><span class="op">=</span><span class="st">"Name"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>bp<span class="op">=</span><span class="va">pos</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FDb.InfiniumMethylation.hg19</span><span class="op">)</span></span>
<span><span class="va">anno</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FDb.InfiniumMethylation.hg19/man/getPlatform.html" class="external-link">get450k</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nearest_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/FDb.InfiniumMethylation.hg19/man/getNearest.html" class="external-link">getNearestGene</a></span><span class="op">(</span><span class="va">anno</span><span class="op">[</span><span class="va">stats_sig</span><span class="op">$</span><span class="va">Probe</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">nearest_gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Probe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">nearest_gene</span><span class="op">)</span>, gene<span class="op">=</span><span class="va">nearest_gene</span><span class="op">$</span><span class="va">nearestGeneSymbol</span><span class="op">)</span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">nearest_gene</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Probe"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="exclude-potential-spurious-probes">Exclude potential spurious probes<a class="anchor" aria-label="anchor" href="#exclude-potential-spurious-probes"></a>
</h3>
<p>Several probes should generally be excluded because they are unreliable, including probes that map to multiple locations in the genome (cross-hybridizing probes) and probes that overlap with genetic variation <span class="citation">(Zhou, Laird, and Shen 2017)</span>.</p>
<div class="section level4">
<h4 id="cross-hybridization">Cross-hybridization<a class="anchor" aria-label="anchor" href="#cross-hybridization"></a>
</h4>
<p>We have previously described several cross-hybridization issues <span class="citation">(Hop et al. 2020)</span>, which is accompanied by an R package (<a href="https://github.com/pjhop/DNAmCrosshyb" class="external-link">DNAmCrosshyb</a>) to map probes to either the entire genome or to specific DNA sequences. Below we will do the former, testing whether the 30bp 3’-subsequence matches multiple locations in the genome.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Mask probes </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">DNAmCrosshyb</span><span class="op">)</span></span>
<span><span class="va">genome_bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/genome_bs/hg19"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DNAmCrosshyb/man/map_probes.html" class="external-link">map_probes</a></span><span class="op">(</span><span class="va">stats_sig</span><span class="op">$</span><span class="va">Probe</span>,</span>
<span>                      path <span class="op">=</span> <span class="va">genome_bs</span>,</span>
<span>                      chromosomes <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                      min_width <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                      max_width <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                      step_size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                      allow_mismatch <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      allow_INDEL <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      cores <span class="op">=</span> <span class="fl">1</span></span>
<span>                     <span class="op">)</span></span>
<span><span class="co">#&gt; Width: 30</span></span>
<span><span class="co">#&gt; Mapping probes to chromosome ..</span></span>
<span><span class="co">#&gt; 1</span></span>
<span><span class="co">#&gt; 2</span></span>
<span><span class="co">#&gt; 3</span></span>
<span><span class="co">#&gt; 4</span></span>
<span><span class="co">#&gt; 5</span></span>
<span><span class="co">#&gt; 6</span></span>
<span><span class="co">#&gt; 7</span></span>
<span><span class="co">#&gt; 8</span></span>
<span><span class="co">#&gt; 9</span></span>
<span><span class="co">#&gt; 10</span></span>
<span><span class="co">#&gt; 11</span></span>
<span><span class="co">#&gt; 12</span></span>
<span><span class="co">#&gt; 13</span></span>
<span><span class="co">#&gt; 14</span></span>
<span><span class="co">#&gt; 15</span></span>
<span><span class="co">#&gt; 16</span></span>
<span><span class="co">#&gt; 17</span></span>
<span><span class="co">#&gt; 18</span></span>
<span><span class="co">#&gt; 19</span></span>
<span><span class="co">#&gt; 20</span></span>
<span><span class="co">#&gt; 21</span></span>
<span><span class="co">#&gt; 22</span></span>
<span><span class="co">#&gt; X</span></span>
<span><span class="co">#&gt; Y</span></span>
<span><span class="co">#&gt; M</span></span>
<span></span>
<span><span class="co"># Check which matches do not match with the intended position</span></span>
<span><span class="va">matches_mismatch</span> <span class="op">&lt;-</span> <span class="va">matches</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu">DNAmCrosshyb</span><span class="fu">:::</span><span class="va">anno450k</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>probeType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">Name</span>,<span class="st">"ch"</span><span class="op">)</span>, <span class="st">"ch"</span>, <span class="st">"cg"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"chr"</span>, <span class="st">"pos"</span>, <span class="st">"probeType"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>chr_annotated <span class="op">=</span> <span class="va">chr</span>, c_pos_annotated <span class="op">=</span> <span class="va">pos</span><span class="op">)</span>,</span>
<span>                   by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Probe"</span> <span class="op">=</span> <span class="st">"Name"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    c_pos <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">strand</span> <span class="op">==</span> <span class="st">"forward"</span> <span class="op">&amp;</span> <span class="va">Type2</span> <span class="op">==</span> <span class="st">"II"</span> <span class="op">&amp;</span> <span class="va">probeType</span> <span class="op">==</span> <span class="st">"cg"</span> <span class="op">~</span> <span class="va">start</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>      <span class="va">strand</span> <span class="op">==</span> <span class="st">"reverse"</span> <span class="op">&amp;</span> <span class="va">Type2</span> <span class="op">==</span> <span class="st">"II"</span> <span class="op">&amp;</span> <span class="va">probeType</span> <span class="op">==</span> <span class="st">"cg"</span>  <span class="op">~</span> <span class="va">end</span>,</span>
<span>      <span class="va">strand</span> <span class="op">==</span> <span class="st">"forward"</span> <span class="op">&amp;</span> <span class="va">probeType</span> <span class="op">==</span> <span class="st">"cg"</span> <span class="op">~</span> <span class="va">start</span>,</span>
<span>      <span class="va">strand</span> <span class="op">==</span> <span class="st">"reverse"</span> <span class="op">&amp;</span> <span class="va">probeType</span> <span class="op">==</span> <span class="st">"cg"</span>  <span class="op">~</span> <span class="va">end</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>      <span class="va">probeType</span> <span class="op">==</span> <span class="st">"ch"</span> <span class="op">&amp;</span> <span class="va">strand</span> <span class="op">==</span> <span class="st">"forward"</span> <span class="op">~</span> <span class="va">start</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>      <span class="va">probeType</span> <span class="op">==</span> <span class="st">"ch"</span> <span class="op">&amp;</span> <span class="va">strand</span> <span class="op">==</span> <span class="st">"reverse"</span> <span class="op">~</span> <span class="va">end</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>chr_annotated <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">chr_annotated</span>, <span class="st">"chr"</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matches_mismatch</span> <span class="op">&lt;-</span> <span class="va">matches_mismatch</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">chr</span> <span class="op">==</span> <span class="va">chr_annotated</span> <span class="op">&amp;</span> <span class="va">c_pos</span> <span class="op">==</span> <span class="va">c_pos_annotated</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">Probe</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="probes-overlapping-with-genetic-variation">Probes overlapping with genetic variation<a class="anchor" aria-label="anchor" href="#probes-overlapping-with-genetic-variation"></a>
</h4>
<p>Often, probes that overlap with genetic variants are excluded, here we use the annotation from Zhou <em>et al.</em> <span class="citation">(Zhou, Laird, and Shen 2017)</span> where the <code>MASK_general</code> column excluded (among others) probes that have a SNP within 5bp of the ’3 end of the probe (with a global MAF &gt; 0.01).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Snp probes</span></span>
<span><span class="co"># Middle Sweden.</span></span>
<span><span class="va">mask</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="st">"https://github.com/zhou-lab/InfiniumAnnotationV1/raw/main/Anno/HM450/archive/202209/HM450.hg38.mask.tsv.gz"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mask</span> <span class="op">&lt;-</span> <span class="va">mask</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">MASK_general</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="filter-and-save-results">Filter and save results<a class="anchor" aria-label="anchor" href="#filter-and-save-results"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter</span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="va">stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">Probe</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">mask</span>, <span class="op">!</span><span class="va">Probe</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">matches_mismatch</span><span class="op">$</span><span class="va">Probe</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">stats</span>,</span>
<span>                 file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">gzfile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>,<span class="st">"/workflow/ewas_stats_limma_bacon_filtered.txt.gz"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                 </span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visualize-results">Visualize results<a class="anchor" aria-label="anchor" href="#visualize-results"></a>
</h3>
<p>For visualization we’ll use a couple of functions (manhattan, qq-plot) that we used in an earlier project</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/pjhop/dnamarray_crossreactivity/master/R/ewas_plot_functions.R"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gg_qqplot</span><span class="op">(</span><span class="va">stats</span><span class="op">$</span><span class="va">p</span>, text_size <span class="op">=</span> <span class="fl">13</span>, point_size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="EWASworkflow_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Several well-known smoking hits are identified, such as those in <em>AHRR</em>, <em>ALPG</em> (<em>ALPPL2</em>) and <em>GFI1</em>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gg.manhattan</span><span class="op">(</span><span class="va">stats</span>, annotate <span class="op">=</span> <span class="cn">TRUE</span>, threshold <span class="op">=</span> <span class="va">threshold</span><span class="op">)</span></span></code></pre></div>
<p><img src="EWASworkflow_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save.image</a></span><span class="op">(</span><span class="st">"../GSE42861/workspace_19092021.rda"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="overlap-with-previous-smoking-ewass">Overlap with previous smoking EWASs<a class="anchor" aria-label="anchor" href="#overlap-with-previous-smoking-ewass"></a>
</h4>
<p>In order to check if the identified hits are concordant with published EWASs on smoking, we can download EWAS test statistics from EWASdb <span class="citation">(liu et al. 2019)</span>. We prefiltered the results in EWASdb on smoking EWASs in blood. Apparently all hits we identify here have previously been found to be associated with smoking!</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">EWASdb_smoking</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/EWASdb_smoking.tsv.gz"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">stats_sig</span> <span class="op">&lt;-</span> <span class="va">stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">p</span> <span class="op">&lt;</span> <span class="fl">2.4</span> <span class="op">*</span><span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">7</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">stats_sig</span><span class="op">$</span><span class="va">Probe</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">EWASdb_smoking</span><span class="op">$</span><span class="va">`Probe id`</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="a-few-alternatives">A few alternatives<a class="anchor" aria-label="anchor" href="#a-few-alternatives"></a>
</h2>
<p>Some alternatives for performing normalization and correction for confounding in EWAS (note that this list is by no means exhaustive).i</p>
<div class="section level3">
<h3 id="normalization">Normalization<a class="anchor" aria-label="anchor" href="#normalization"></a>
</h3>
<div class="section level4">
<h4 id="functional-normalization">Functional normalization<a class="anchor" aria-label="anchor" href="#functional-normalization"></a>
</h4>
<p>Apply functional normalization <span class="citation">(Fortin et al. 2014)</span>, as implemented in <a href="https://bioconductor.org/packages/release/bioc/html/minfi.html" class="external-link">minfi</a> <span class="citation">(Aryee et al. 2014)</span>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hansenlab/minfi" class="external-link">minfi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an RGset</span></span>
<span><span class="va">rgset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minfi/man/read.metharray.html" class="external-link">read.metharray</a></span><span class="op">(</span><span class="va">samplesheet</span><span class="op">$</span><span class="va">Basename</span>, extended<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove sample outliers from RGset</span></span>
<span><span class="va">rgset</span> <span class="op">&lt;-</span> <span class="va">rgset</span><span class="op">[</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rgset</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">sample_outliers</span><span class="op">$</span><span class="va">Sample_Name</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Normalize using functional normalization</span></span>
<span><span class="va">rgset_normalized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minfi/man/preprocessFunnorm.html" class="external-link">preprocessFunnorm</a></span><span class="op">(</span><span class="va">rgset</span>, nPCs <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [preprocessFunnorm] Background and dye bias correction with noob</span></span>
<span><span class="co">#&gt; [preprocessFunnorm] Mapping to genome</span></span>
<span><span class="co">#&gt; [preprocessFunnorm] Quantile extraction</span></span>
<span><span class="co">#&gt; [preprocessFunnorm] Normalization</span></span>
<span></span>
<span><span class="co"># get Beta values </span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minfi/man/MethylSet-class.html" class="external-link">getBeta</a></span><span class="op">(</span><span class="va">rgset_normalized</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Remove failed probes </span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">beta</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">probe_outliers</span><span class="op">$</span><span class="va">Probe</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt;            GSM1051537_7800246085_R01C01 GSM1051538_7800246085_R02C01</span></span>
<span><span class="co">#&gt; cg13869341                   0.75058453                   0.92550477</span></span>
<span><span class="co">#&gt; cg14008030                   0.46853599                   0.50286691</span></span>
<span><span class="co">#&gt; cg12045430                   0.04891289                   0.02700624</span></span>
<span><span class="co">#&gt; cg20826792                   0.07187436                   0.09324314</span></span>
<span><span class="co">#&gt; cg00381604                   0.03581280                   0.03570729</span></span>
<span><span class="co">#&gt;            GSM1051539_7800246085_R03C01</span></span>
<span><span class="co">#&gt; cg13869341                   0.71074909</span></span>
<span><span class="co">#&gt; cg14008030                   0.48952535</span></span>
<span><span class="co">#&gt; cg12045430                   0.04084660</span></span>
<span><span class="co">#&gt; cg20826792                   0.12601386</span></span>
<span><span class="co">#&gt; cg00381604                   0.03502534</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="bigmelon">bigmelon<a class="anchor" aria-label="anchor" href="#bigmelon"></a>
</h4>
<p>The <a href="https://bioconductor.org/packages/release/bioc/html/bigmelon.html" class="external-link">bigmelon</a> package extends the capabilities of <a href="%5B%3Chttps://www.bioconductor.org/packages/release/bioc/html/wateRmelon.html%3E" class="external-link">wateRmelon</a> to work with large data <span class="citation">(Gorrie-Stone et al. 2019)</span>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert mset to gds-file</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">methylumi</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">wateRmelon</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bigmelon</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note for convenience (since we already made an mset) we'll convert</span></span>
<span><span class="co"># the mset to a gds-file. Note that it's also possible within bigmelon</span></span>
<span><span class="co"># to make a gds-file directly from IDATs, in which case you don't have to </span></span>
<span><span class="co"># load the entire mset into memory.</span></span>
<span></span>
<span><span class="va">mset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/mset_cleaned.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/bigmelon/man/es2gds.html" class="external-link">es2gds</a></span><span class="op">(</span><span class="va">mset</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/mset_cleaned_gds.gds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Normalize using dasen:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/wateRmelon/man/dasen.html" class="external-link">dasen</a></span><span class="op">(</span><span class="va">gfile</span>, node <span class="op">=</span> <span class="st">"dasen"</span><span class="op">)</span> <span class="co"># note that this is written to disk</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">methylumi</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">wateRmelon</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bigmelon</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: gdsfmt</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'bigmelon'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:wateRmelon':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     fot</span></span>
<span></span>
<span><span class="va">gfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gdsfmt/man/openfn.gds.html" class="external-link">openfn.gds</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/mset_cleaned_gds.gds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/methylumi/man/generics.html" class="external-link">betas</a></span><span class="op">(</span><span class="va">gfile</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;            GSM1051537_7800246085_R01C01 GSM1051538_7800246085_R02C01</span></span>
<span><span class="co">#&gt; cg00000029                    0.4672474                    0.5275294</span></span>
<span><span class="co">#&gt; cg00000108                    0.9141924                    0.9483415</span></span>
<span><span class="co">#&gt; cg00000109                    0.8169325                    0.8150556</span></span>
<span><span class="co">#&gt; cg00000165                    0.1915413                    0.1982974</span></span>
<span><span class="co">#&gt; cg00000236                    0.6762045                    0.6667227</span></span>
<span><span class="co">#&gt;            GSM1051539_7800246085_R03C01 GSM1051540_7800246085_R04C01</span></span>
<span><span class="co">#&gt; cg00000029                    0.5797849                    0.4421098</span></span>
<span><span class="co">#&gt; cg00000108                    0.9293939                    0.9273094</span></span>
<span><span class="co">#&gt; cg00000109                    0.8524102                    0.8172436</span></span>
<span><span class="co">#&gt; cg00000165                    0.2953869                    0.1702659</span></span>
<span><span class="co">#&gt; cg00000236                    0.7365415                    0.6505629</span></span>
<span><span class="co">#&gt;            GSM1051541_7800246085_R05C01</span></span>
<span><span class="co">#&gt; cg00000029                    0.5412268</span></span>
<span><span class="co">#&gt; cg00000108                    0.9452033</span></span>
<span><span class="co">#&gt; cg00000109                    0.8458453</span></span>
<span><span class="co">#&gt; cg00000165                    0.3284349</span></span>
<span><span class="co">#&gt; cg00000236                    0.7484540</span></span>
<span><span class="va">gfile</span><span class="op">[</span>,, node <span class="op">=</span> <span class="st">"dasen"</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt;            GSM1051537_7800246085_R01C01 GSM1051538_7800246085_R02C01</span></span>
<span><span class="co">#&gt; cg00000029                    0.4792575                    0.5064967</span></span>
<span><span class="co">#&gt; cg00000108                    0.9113283                    0.9379213</span></span>
<span><span class="co">#&gt; cg00000109                    0.8055602                    0.7862427</span></span>
<span><span class="co">#&gt; cg00000165                    0.2089593                    0.1994138</span></span>
<span><span class="co">#&gt; cg00000236                    0.6776440                    0.6425773</span></span>
<span><span class="co">#&gt;            GSM1051539_7800246085_R03C01 GSM1051540_7800246085_R04C01</span></span>
<span><span class="co">#&gt; cg00000029                    0.5537130                    0.4111877</span></span>
<span><span class="co">#&gt; cg00000108                    0.9186864                    0.9072468</span></span>
<span><span class="co">#&gt; cg00000109                    0.8128120                    0.7760345</span></span>
<span><span class="co">#&gt; cg00000165                    0.2878259                    0.1656514</span></span>
<span><span class="co">#&gt; cg00000236                    0.7108333                    0.6062183</span></span>
<span><span class="co">#&gt;            GSM1051541_7800246085_R05C01</span></span>
<span><span class="co">#&gt; cg00000029                    0.4940065</span></span>
<span><span class="co">#&gt; cg00000108                    0.9311152</span></span>
<span><span class="co">#&gt; cg00000109                    0.8066294</span></span>
<span><span class="co">#&gt; cg00000165                    0.2886662</span></span>
<span><span class="co">#&gt; cg00000236                    0.7053345</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gdsfmt/man/closefn.gds.html" class="external-link">closefn.gds</a></span><span class="op">(</span><span class="va">gfile</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="ewas">EWAS<a class="anchor" aria-label="anchor" href="#ewas"></a>
</h3>
<div class="section level4">
<h4 id="osca">OSCA<a class="anchor" aria-label="anchor" href="#osca"></a>
</h4>
<p>OSCA (<a href="https://cnsgenomics.com/software/osca/#Overview" class="external-link">link</a>) is a recent method in which the random effect of total genome-wide DNA methylation captures the correlation structure between probes and directly controls for the genomic inflation <span class="citation">(Zhang et al. 2019)</span>. OSCA is written in C/C++, and is available as a command-line executable, thus after preparing the data in the right format, we’ll run OSCA from the command-line.</p>
</div>
<div class="section level4">
<h4 id="save-data-in-osca-format">Save data in OSCA format<a class="anchor" aria-label="anchor" href="#save-data-in-osca-format"></a>
</h4>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">##  Add 'IID' and 'FID' columns to beta-file </span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span>, <span class="va">beta</span><span class="op">)</span></span>
<span><span class="co">#&gt; New names:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `samples` -&gt; `samples...1`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> `samples` -&gt; `samples...2`</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'IID'</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'FID'</span></span>
<span></span>
<span><span class="co"># Write to txt-file</span></span>
<span><span class="co"># readr::write_tsv(beta, </span></span>
<span><span class="co">#                  path = paste0(outdir, "/workflow/osca/beta_cleaned_normalized_osca.txt"), </span></span>
<span><span class="co">#                  col_names = TRUE)</span></span>
<span></span>
<span><span class="co"># faster alternative</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span><span class="va">beta</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"/workflow/beta_cleaned_normalized_osca.txt"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\t"</span>, na <span class="op">=</span> <span class="st">"NA"</span>, quote <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Save covariates and phenotype:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Covariates ---------------------------------------------------------------</span></span>
<span><span class="va">qcovariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age"</span>, <span class="st">"Alcohol_PMS"</span>, <span class="st">"BMI_PMS"</span>, <span class="st">"NK"</span>, <span class="st">"CD4T"</span>, <span class="st">"CD8T"</span>, <span class="st">"Mono"</span>, <span class="st">"Neutro"</span><span class="op">)</span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"disease_state"</span>, <span class="st">"Sex"</span><span class="op">)</span></span>
<span><span class="va">phenotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Smoking"</span><span class="op">)</span></span>
<span><span class="va">levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select covariates/phenotype</span></span>
<span><span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="va">samplesheet</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">samplesheet</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">covariates</span>, <span class="va">qcovariates</span>, <span class="va">phenotype</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">samplesheet</span> <span class="op">&lt;-</span> <span class="va">samplesheet</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="va">phenotype</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">levels</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">samplesheet</span><span class="op">[</span>,<span class="va">covariates</span>,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>, <span class="fl">2</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">covar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>IID <span class="op">=</span> <span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span>, FID <span class="op">=</span> <span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span>, <span class="va">covar</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qcovar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>IID <span class="op">=</span> <span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span>, FID <span class="op">=</span> <span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span>, <span class="va">samplesheet</span><span class="op">[</span>,<span class="va">qcovariates</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">phenotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>IID <span class="op">=</span> <span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span>, FID <span class="op">=</span> <span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span>,</span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">samplesheet</span><span class="op">[[</span><span class="va">phenotype</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">levels</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>IID <span class="op">=</span> <span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span>, FID <span class="op">=</span> <span class="va">samplesheet</span><span class="op">$</span><span class="va">Sample_Name</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Save</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">qcovar</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/workflow/osca/qcovar.txt"</span>, <span class="va">outdir</span><span class="op">)</span>, col_names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">covar</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/workflow/osca/covar.txt"</span>, <span class="va">outdir</span><span class="op">)</span>, col_names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">keep</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/workflow/osca/keep.txt"</span>, <span class="va">outdir</span><span class="op">)</span>, col_names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">phenotype</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/workflow/osca/pheno.txt"</span>, <span class="va">outdir</span><span class="op">)</span>, col_names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="run-osca-in-the-command-line">Run OSCA in the command-line<a class="anchor" aria-label="anchor" href="#run-osca-in-the-command-line"></a>
</h4>
<p>Convert txt-file to OSCA’s format (in command-line):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1"></a><span class="va">outdir=</span><span class="st">"../GSE42861"</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="va">oscapath=</span><span class="st">"~/osca_Linux"</span></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="fu">mkdir</span> <span class="va">$outdir</span>/workflow/osca</span>
<span id="cb26-4"><a href="#cb26-4"></a><span class="ex">~/osca_Linux</span> --efile <span class="va">${outdir}</span>/workflow/osca/beta_cleaned_normalized_osca.txt \</span>
<span id="cb26-5"><a href="#cb26-5"></a>--methylation-beta \</span>
<span id="cb26-6"><a href="#cb26-6"></a>--make-bod \</span>
<span id="cb26-7"><a href="#cb26-7"></a>--out <span class="va">${outdir}</span>/workflow/osca/beta_cleaned_normalized_osca <span class="op">&gt;</span> <span class="va">${outdir}</span>/workflow/osca/beta_cleaned_normalized_osca.log</span></code></pre></div>
<p>Run OSCA MOA:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1"></a><span class="va">outdir=</span><span class="st">"../GSE42861"</span></span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="ex">~/osca_Linux</span> --befile <span class="va">${outdir}</span>/workflow/beta_cleaned_normalized_osca \</span>
<span id="cb27-4"><a href="#cb27-4"></a>--pheno <span class="va">${outdir}</span>/workflow/osca/pheno.txt \</span>
<span id="cb27-5"><a href="#cb27-5"></a>--covar <span class="va">${outdir}</span>/workflow/osca/covar.txt \</span>
<span id="cb27-6"><a href="#cb27-6"></a>--qcovar <span class="va">${outdir}</span>/workflow/osca/qcovar.txt \</span>
<span id="cb27-7"><a href="#cb27-7"></a>--moa \</span>
<span id="cb27-8"><a href="#cb27-8"></a>--out <span class="va">${outdir}</span>/workflow/osca/ewas_moa</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="visualize">Visualize<a class="anchor" aria-label="anchor" href="#visualize"></a>
</h4>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ewas_moa</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_tsv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%s/workflow/osca/ewas_moa.moa"</span>, <span class="va">outdir</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ewas_moa</span> <span class="op">&lt;-</span> <span class="va">ewas_moa</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">Probe</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">mask</span>, <span class="op">!</span><span class="va">Probe</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html" class="external-link">%in%</a></span> <span class="va">matches_mismatch</span><span class="op">$</span><span class="va">Probe</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ewas_moa</span> <span class="op">&lt;-</span> <span class="va">ewas_moa</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Chr"</span>, <span class="st">"bp"</span>, <span class="st">"Gene"</span>, <span class="st">"Orientation"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">anno_450k</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"chr"</span>, <span class="st">"pos"</span>, <span class="st">"UCSC_RefGene_Name"</span>, <span class="st">"UCSC_RefGene_Group"</span><span class="op">)</span><span class="op">]</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Probe"</span><span class="op">=</span><span class="st">"Name"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>bp<span class="op">=</span><span class="va">pos</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ewas_moa</span> <span class="op">&lt;-</span> <span class="va">ewas_moa</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">nearest_gene</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Probe"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Note that the inflation if a bit lower than in the limma+bacon results (<a href="#visualize-results">Visualize results</a>):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gg_qqplot</span><span class="op">(</span><span class="va">ewas_moa</span><span class="op">$</span><span class="va">p</span>, text_size <span class="op">=</span> <span class="fl">13</span>, point_size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="EWASworkflow_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">gg.manhattan</span><span class="op">(</span><span class="va">ewas_moa</span>, annotate <span class="op">=</span> <span class="cn">TRUE</span>, threshold <span class="op">=</span> <span class="va">threshold</span><span class="op">)</span></span></code></pre></div>
<p><img src="EWASworkflow_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>compare with limma+bacon results</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stats</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ewas_moa</span>, by<span class="op">=</span><span class="st">"Probe"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p.x</span><span class="op">)</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p.y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"-log10(P) LB"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"-log10(P) OSCA MOA"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EWASworkflow_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-aryee_minfi_2014">
<p>Aryee, Martin J, Andrew E Jaffe, Hector Corrada-Bravo, Christine Ladd-Acosta, Andrew P Feinberg, Kasper D Hansen, and Rafael A Irizarry. 2014. “Minfi: A Flexible and Comprehensive Bioconductor Package for the Analysis of Infinium DNA Methylation Microarrays.” <em>Bioinformatics</em> 30 (10): 1363–9.</p>
</div>
<div id="ref-fortin_functional_2014">
<p>Fortin, Jean-Philippe, Aurélie Labbe, Mathieu Lemire, Brent W Zanke, Thomas J Hudson, Elana J Fertig, Celia MT Greenwood, and Kasper D Hansen. 2014. “Functional Normalization of 450k Methylation Array Data Improves Replication in Large Cancer Studies.” <em>Genome Biology</em> 15 (11): 1–17.</p>
</div>
<div id="ref-gorrie-stone_bigmelon_2019">
<p>Gorrie-Stone, Tyler J, Melissa C Smart, Ayden Saffari, Karim Malki, Eilis Hannon, Joe Burrage, Jonathan Mill, Meena Kumari, and Leonard C Schalkwyk. 2019. “Bigmelon: Tools for Analysing Large DNA Methylation Datasets.” Edited by Janet Kelso. <em>Bioinformatics</em> 35 (6): 981–86. <a href="https://doi.org/10.1093/bioinformatics/bty713" class="external-link">https://doi.org/10.1093/bioinformatics/bty713</a>.</p>
</div>
<div id="ref-hop_cross-reactive_2020">
<p>Hop, Paul J, Ramona A J Zwamborn, Eilis J Hannon, Annelot M Dekker, Kristel R van Eijk, Emma M Walker, Alfredo Iacoangeli, et al. 2020. “Cross-Reactive Probes on Illumina DNA Methylation Arrays: A Large Study on ALS Shows That a Cautionary Approach Is Warranted in Interpreting Epigenome-Wide Association Studies.” <em>NAR Genomics and Bioinformatics</em> 2 (4).</p>
</div>
<div id="ref-van_iterson_controlling_2017">
<p>Iterson, Maarten van, Erik W. van Zwet, and Bastiaan T. Heijmans. 2017. “Controlling Bias and Inflation in Epigenome- and Transcriptome-Wide Association Studies Using the Empirical Null Distribution.” <em>Genome Biology</em> 18 (19): 19. <a href="http://genomebiology.biomedcentral.com/articles/10.1186/s13059-016-1131-9" class="external-link">http://genomebiology.biomedcentral.com/articles/10.1186/s13059-016-1131-9</a>.</p>
</div>
<div id="ref-liu_ewasdb_2019">
<p>liu, Di, Linna Zhao, Zhaoyang Wang, Xu Zhou, Xiuzhao Fan, Yong Li, Jing Xu, et al. 2019. “EWASdb: Epigenome-Wide Association Study Database.” <em>Nucleic Acids Research</em> 47 (D1): D989–D993. <a href="https://doi.org/10.1093/nar/gky942" class="external-link">https://doi.org/10.1093/nar/gky942</a>.</p>
</div>
<div id="ref-liu_epigenome-wide_2013">
<p>Liu, Yun, Martin J Aryee, Leonid Padyukov, M Daniele Fallin, Espen Hesselberg, Arni Runarsson, Lovisa Reinius, et al. 2013. “Epigenome-Wide Association Data Implicate DNA Methylation as an Intermediary of Genetic Risk in Rheumatoid Arthritis.” <em>Nature Biotechnology</em> 31 (2): 142–47. <a href="https://doi.org/10.1038/nbt.2487" class="external-link">https://doi.org/10.1038/nbt.2487</a>.</p>
</div>
<div id="ref-pidsley_data-driven_2013">
<p>Pidsley, Ruth, Chloe CY Wong, Manuela Volta, Katie Lunnon, Jonathan Mill, and Leonard C Schalkwyk. 2013. “A Data-Driven Approach to Preprocessing Illumina 450K Methylation Array Data.” <em>BMC Genomics</em> 14 (293): 1–10.</p>
</div>
<div id="ref-ritchie_limma_2015">
<p>Ritchie, Matthew E., Belinda Phipson, Di Wu, Yifang Hu, Charity W. Law, Wei Shi, and Gordon K. Smyth. 2015. “Limma Powers Differential Expression Analyses for RNA-Sequencing and Microarray Studies.” <em>Nucleic Acids Research</em> 43 (7): e47–e47. <a href="https://doi.org/10.1093/nar/gkv007" class="external-link">https://doi.org/10.1093/nar/gkv007</a>.</p>
</div>
<div id="ref-zhang_osca_2019">
<p>Zhang, Futao, Wenhan Chen, Zhihong Zhu, Qian Zhang, Marta F. Nabais, Ting Qi, Ian J. Deary, et al. 2019. “OSCA: A Tool for Omic-Data-Based Complex Trait Analysis.” <em>Genome Biology</em> 20 (107): 107. <a href="https://doi.org/10.1186/s13059-019-1718-z" class="external-link">https://doi.org/10.1186/s13059-019-1718-z</a>.</p>
</div>
<div id="ref-zhou_comprehensive_2017">
<p>Zhou, Wanding, Peter W. Laird, and Hui Shen. 2017. “Comprehensive Characterization, Annotation and Innovative Use of Infinium DNA Methylation BeadChip Probes.” <em>Nucleic Acids Research</em> 45 (4): e22. <a href="https://doi.org/10.1093/nar/gkw967" class="external-link">https://doi.org/10.1093/nar/gkw967</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul Hop.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
